pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- general
tm_name = "poopy"
health = 16
hunger = 0
hunger_hurt_thres = 60
hunger_hurt_period = 10
frame = 0

function _init()
	--start_name_select()
end
function feed(amount)
	if hunger > amount then
		hunger -= amount
	else
		hunger = 0
	end
end

function test_update()
	hunger += 1
	if hunger > hunger_hurt_thres then
		health -= 1
		hunger -= hunger_hurt_period
	end
	if health == 0 then
		_draw = draw_gameover
	end
end

function test_draw()
	cls()
	for i=1,16 do
		if health >= i then
			pset(i,0,3)
		end
	end
end

function draw_gameover()
	for i=1,64 do
		pset(rnd(127),rnd(127),8)
	end
end

-->8
-- name selection
ns_size = 5
ns_letters = "_abcdefghijklmnopqrstuvwxyz0123456789"
function start_name_select()
	ns_pos = 0
	ns_name = {}
	for i=0,ns_size-1 do
		ns_name[i] = 0
	end
	_update = ns_update
	_draw = ns_draw
end
function ns_update()
	if btnp(4) then
		-- set tama name
		tm_name = ""
		for i=0,ns_size-1 do
			if ns_name[i] > 0 then
				tm_name = tm_name .. sub(ns_letters, ns_name[i]+1, ns_name[i]+1)
			end
		end
		sfx_ui_act()
		_update = function() end
		_draw = function() end
	elseif btnp(0) then
		ns_pos -= 1
		sfx_ui_move()
	elseif btnp(1) then
		ns_pos += 1
		sfx_ui_move()
	elseif btnp(2) then
		ns_name[ns_pos] += 1
		sfx_ui_move()
	elseif btnp(3) then
		ns_name[ns_pos] -= 1
		sfx_ui_move()
	end
	ns_pos = (ns_pos+ns_size) % ns_size
	ns_name[ns_pos] = (ns_name[ns_pos]+#ns_letters) % #ns_letters
	frame += 1
end
function ns_draw()
	cls()
	-- add background here

	local name = ""
	for i=0,ns_size-1 do
		if i==ns_pos and (frame%16) < 8 then
			name = name .. (ns_name[i]>0 and "_" or " ")
		else
			name = name .. sub(ns_letters, ns_name[i]+1, ns_name[i]+1)
		end
	end

	print("choose a name:", 40, 50)
	print(name, 55, 60)
end

-->8
-- ui

buttons = {
	{ -- Feed
		sprite = 16,
	},
	{ -- Sleep
		sprite = 18,
	},
	{ -- Pet
		sprite = 20,
	},
}
ui_select = 1

function ui_update()
	if btnp(4) then
		buttons[ui_select].action()
	elseif btnp(0) then
		ui_select = mod(ui_select-1, #buttons)
		sfx_ui_move()
	elseif btnp(1) then
		ui_select = mod(ui_select+1, #buttons)
		sfx_ui_move()
	end
	frame += 1
end
function ui_draw()
	cls()
	map(1,3,8,0,8,2)
	for i,button in pairs(buttons) do
		spr(button.sprite, i*16, 0, 2, 2)
		if i==ui_select and frame%8 < 4 then
			spr(22, i*16, 0, 2, 2) -- select sprite
		end
	end
end

-->8
-- sound

function sfx_ui_move()
	sfx(0, 0, 0, 8)
end

function sfx_ui_act()
	sfx(1, 0, 0, 3)
end
-->8
-- util

function mod(x,m)
	return ((x+m-1) % m)+1
end

__gfx__
0000000000000a0a080000aa00000000000000000000000000000222222222222220000000000000000000000000000000000000000000000000000000000000
00000000000000000800000a00000000000000000880300000000222222222222220000000000000000000000000000000000000000000000000000000000000
007007000000000a8e8ee000000ccc00000e0e008883000000000222222222222220000000000000000000000000000000000000000000000000000000000000
0007700000000000008e8e0000000c0000eeeee08888800000000222222222222220000000000000000000000000000000000000000000000000000000000000
000770000000000000e8e80000cc0cc0000eee008888800000000222222222222220000000000000000000000000000000000000000000000000000000000000
00700700a0000000000e8800000c00000000e0000888000000000222222222222220000000000000000000000000000000000000000000000000000000000000
0000000000000000a0000e88000cc000000000000000000000000222222222222220000000000000000000000000000000000000000000000000000000000000
00000000a0a00000aa00080000000000000000000000000000000022222222222200000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000aaaaaa2222222222222222000000000022222222222220000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000a2222222222222222000000000022222222222220000000000000000000000000
00000003000000000000000000cc00000000000000000000000000000000000a2222222222222222000000000022222222222220000000000000000000000000
0000000300000000000077770c1c0c00000000000000f000000000000000000a2222222222222222000000000022222222222220000000000000000000000000
000003333330000000077700010cc10000000000f0001000000000000000000a2222222222222222000000000022222222222220000000000000000000000000
000038833883000000777000000c100000000000100f0000000000000000000a2222222222222222000000000022222222222220000000000000000000000000
0008888838888000007770000cc000000000ee0ee0fff00000000000000000002222222222222222000000000022222222222220000000000000000000000000
000888988898800000777000c1c0c000000eeeeeee1f100000000000000000002222222222222222000000000022222222222220000000000000000000000000
00088888988880000077700010cc1000000eeeeeee01000000000000000000002222222222222222000000000022222222222220000000000000000000000000
00018898889810000077700000c100000001eeeee100f00000000000000000002222222222222222000000000022222222222220000000000000000000000000
0000188898810000007777000717000000001eee10001000a0000000000000002222222222222222000000000022222222222220000000000000000000000000
00000188881000000017777777710000000001e100000000a0000000000000002222222222222222000000000022222222222220000000000000000000000000
000000188100000000017777771000000000001000000000a0000000000000002222222222222222000000000002222222222200000000000000000000000000
000000011000000000001111110000000000000000000000a0000000000000002222222222222222000000000002222222222200000000000000000000000000
000000000000000000000000000000000000000000000000a0000000000000002222222222222222000000000002222222222200000000000000000000000000
000000000000000000000000000000000000000000000000aaaaaa00000000002222222222222222000000000000002222200000000000000000000000000000
__map__
0f1d101112131415001617000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1f2d202122232425002627000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001b1819181918191c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002b2829282928292c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000270000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000015050150501605017050180501a0501b0501c0501c0001d0001d5001f50020500191000e1000710005100161001710018100181001810018100191001a1001c1001e1001f10021100000000000000000
0006000015050190501c05020000270001e000180001100005000010001d0001c0001700013000100000d0000a000050000300000000000000000000000000000000000000000000000000000000000000000000
010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000
00 00000000

